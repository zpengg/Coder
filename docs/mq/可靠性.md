# 可靠性
## 场景
生产者发送消息到MQ失败
MQ接收失败或者路由失败
消息入队之后MQ宕机
消费者无法正常消费
### 生产者发送消息到MQ失败
可能网络抖动（retry）， 集群挂（一段时间后恢复）等
 - rabbitMq confirm机制 & msg 唯一id 
 - kafka ack & retry

协议上，事务机制

### MQ接收失败或者路由失败
生产者进行异常处理 重发
### 消息入队之后MQ宕机
多副本机制保证可用性
持久化保证数据可靠性，但仍然可能存在，内存未落盘 的情况，比如
 - kill -9 没有优雅关闭
 - kafka produce.type =async 的情况
 
### 消费者无法正常消费
消费者 自行保证幂等性

## 处理方法（RabbitMQ）
生产者发出后保证到达了MQ。
MQ收到消息保证分发到了消息对应的Exchange。
Exchange分发消息入队之后保证消息的持久性。
消费者收到消息之后保证消息的正确消费。