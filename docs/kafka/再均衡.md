# 再均衡
高可用 伸缩性。 但调整过程可能重复消费
对集群节点 均衡负载
对消费者高可用
## 场景
主要时3中
 - 消费者订阅的任何主题发生变化
    - 如果你订阅了一个还尚未创建的主题，那么重平衡在该主题创建时发生。如果你订阅的主题发生删除那么也会发生重平衡
 - 分区数量发生变化 
 - 消费者数量发生变化
    - 消费者被群组协调器认为是 DEAD 状态，这可能是由于消费者崩溃或者长时间处于运行状态下发生的，这意味着在配置合理时间的范围内，消费者没有向群组协调器发送任何心跳，这也会导致重平衡的发生。

## 目标
响应 [[分区]] - [[消费者]] 变化， 让**消费者**消费分区数量, 尽量均衡节点负载

## 消费者协调
### 旧版 直接更新 zookeeper （有问题）
### 新版 Leader选举 & 分区分配策略
新版 通过 [[组协调器]] 和 [[消费者协调器]] 进行
[[消费者 Leader 选举]]
[[消费者分区分配策略]]

## 场景
consumer group +- consumer
consumer topic change



## 再均衡监听器
```java
interface ConsumerRebalanceListener{
    onPartionsRevoked(); // 再均衡开始前 消费者停止读取消息之后
    onPartionsAssigned(); // 重新分配之后，消费者开始读之前
}
```

两个时机分别执行操作避免重复消费
store  offset in db
seek offset from db
