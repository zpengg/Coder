# 组协调器
## 旧版
zookeeper watcher
/consumers/<group>/ids 
/brokers/ids
整个消费组都调整。不必要

### 问题 
消费者之间互不透明

#### 羊群效应
大量通知 性能低
#### 脑裂
每个消费者与zookeeper 通信时 获取的集群信息不一样

## 新版
###  作用
组协调器 GroupCoordinator 配合 [[消费者协调器]]的 管理消费者组
同时集中管理[[消费位移]] 

### 分区工作压力转移到消费者
leader consumer会承担分区分配的工作，**这样kafka集群的压力会小很多**。同组的consumer通过组协调器保持同步。消费者和分区的对应关系持久化在kafka内部主题。

### 工作流程
组协调器负责处理[[消费者协调器]]发过来的各种请求。它主要提供如下功能：

在与之连接的消费者中选举出消费者leader
下发leader消费者返回的消费者分区分配结果给所有的消费者
管理消费者的消费偏移量提交，保存在kafka的内部主题中
和消费者心跳保持，知道哪些消费者已经死掉，组中存活的消费者是哪些。
组协调器在broker启动的时候实例化，每个组协调器负责一部分消费组的管理。它主要