# 组协调器
## 旧版
zookeeper watcher
/consumers/<group>/ids 
/brokers/ids
整个消费组都调整。不必要

### 问题 
消费者之间互不透明

#### 羊群效应
大量通知 性能低
#### 脑裂
每个消费者与zookeeper 通信时 获取的集群信息不一样

## 新版
###  作用
组协调器在broker启动的时候实例化
组协调器 GroupCoordinator 配合 [[消费者协调器]]的 管理部分消费者组
同时集中管理[[消费位移]] 
和消费者心跳保持，知道哪些消费者已经死掉，组中存活的消费者是哪些。

### 场景
入组
主动离组
崩溃离组
[[再均衡]]时提交位移, 避免重复消费

### 分区工作压力转移到消费者
leader consumer会承担分区分配的工作，**这样kafka集群的压力会小很多**。同组的consumer通过组协调器保持同步。消费者和分区的对应关系持久化在kafka内部主题。
