# JMM-JAVA 内存模型

## 硬件
多核和缓存机制
```
CPU register              CPU register 
CPu cache memory          CPu cache memory
               RAM -Main Memor 
```

## 内存模型
``` 
JAVA 逻辑上
线程A            线程B
本地内存         本地内存
     RAM -Main Memor 
```
主存 存有 变量
本地内存 有 变量副本

实现上与 硬件 和 编译器优化有关

## 指令重排
硬件和编译器优化可能会产生 [[指令重排]]。有可能影响[[可见性]]

## 顺序一致性模型
- 一个线程中的所有操作必须按照程序的顺序来执行
- 所有线程都只能看到同一个单一的操作执行顺序

每个操作都必须原子执行且立刻对所有线程可见

### JMM 多线程不满足 顺序一致性模型
在 JMM 中就没有这个保证。未同步程序在 JMM 中不但整体的执行顺序是无序的，而且所有线程看到的操作执行顺序也可能不一致。

### JMM 提供的可见性保证
- 单线程程序。 as-if-serials
- 正确**同步**的多线程程序。可满足顺序一致性
- 未同步 / 未正确同步的多线程程序。JMM 为它们提供了最小安全性保障：线程执行时读取到的值，要么是之前某个线程写入的值，要么是默认值（0，null，false）。
