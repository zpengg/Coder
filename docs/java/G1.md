# G1
G1(Garbage-First)，它是一款面向服务端应用的垃圾收集器，在多 CPU 和大内存的场景下有很好的性能

## 使命
停顿时间短，只回收价值大的分区，比CMS 全old 扫描 有优势，目标是替代 CMS

## 分代但物理不隔离，
G1 把堆划分成多个大小相等的独立区域(Region)， 新生代和老年代不再物理隔离。

## 分区 region 
分区大小相等。
分区内部,对象分配以Card page为单位, 512 Byte
分区可认领作lab，如[[TLAB]]

### Humongous Region 巨型对象：多分区、性能低
可能占用多个分区，无法使用lab
分配时要扫描整堆 STW
成本高

## Remembered set 
[[RSet]] 用来辅助可达性分析
RSet 内部 [[PRT]] Per Region Table(PRT)记录分区的引用情况

## 过程
初始标记
并发标记: [[三色标记]]
最终标记: 为了修正在并发标记期间因用户程序继续运作而导致标记产生变动的那一部分标记记录，虚拟机将这段时间对象变化记录在线程的 Remembered Set Logs 里面，最终标记阶段需要把 Remembered Set Logs 的数据合并到 Remembered Set 中。这阶段需要停顿线程，但是可并行执行。

筛选回收: 首先对各个 Region 中的回收价值和成本进行排序，根据用户所期望的 GC 停顿时间来制定回收计划。此阶段其实也可以做到与用户程序一起并发执行，但是因为只回收一部分 Region，时间是用户可控制的，而且停顿用户线程将大幅度提高收集效率。

## 无碎片
分区总体是整理
分区之间是复制
这意味着运行期间不会产生内存空间碎片。

## 混合原因
为什么要有混合模式，而不是 Old 模式？

因为，Old 对象可能被 Young 区引用，这时 Young可能已经变成垃圾了，所以一起回收可能会释放更多的 Old 空间。